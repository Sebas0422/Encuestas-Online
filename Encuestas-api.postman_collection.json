{
  "info": {
    "name": "MiBackend - Auth & Users",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_postman_id": "b2e0b8b0-0000-4abc-8000-1762374550"
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:8080"
    },
    {
      "key": "token",
      "value": ""
    },
    {
      "key": "user_id",
      "value": ""
    },
    {
      "key": "user_email",
      "value": ""
    },
    {
      "key": "campaign_id",
      "value": ""
    },
    {
      "key": "form_id",
      "value": ""
    },
    {
      "key": "section_id",
      "value": ""
    }
  ],
  "item": [
    {
      "name": "Auth",
      "item": [
        {
          "name": "Register",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/auth/register",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "auth",
                "register"
              ]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"admin@example.com\",\n  \"fullName\": \"Admin User\",\n  \"password\": \"Str0ng!Passw0rd\",\n  \"systemAdmin\": true\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "let json;",
                  "try { json = pm.response.json(); } catch (e) { json = {}; }",
                  "if (json && json.accessToken) {",
                  "  pm.environment.set('token', json.accessToken);",
                  "  pm.environment.set('user_id', json.userId);",
                  "  pm.environment.set('user_email', json.email);",
                  "}",
                  "pm.test('Status 200', function () { pm.response.to.have.status(200); });"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Login",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/auth/login",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "auth",
                "login"
              ]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"admin@example.com\",\n  \"password\": \"Str0ng!Passw0rd\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "let json;",
                  "try { json = pm.response.json(); } catch (e) { json = {}; }",
                  "if (json && json.accessToken) {",
                  "  pm.environment.set('token', json.accessToken);",
                  "  pm.environment.set('user_id', json.userId);",
                  "  pm.environment.set('user_email', json.email);",
                  "}",
                  "pm.test('Status 200', function () { pm.response.to.have.status(200); });"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Users (protected)",
      "auth": {
        "type": "bearer",
        "bearer": [
          {
            "key": "token",
            "value": "{{token}}",
            "type": "string"
          }
        ]
      },
      "item": [
        {
          "name": "Create User",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/users",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "users"
              ]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"user1@example.com\",\n  \"fullName\": \"User One\",\n  \"systemAdmin\": false\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "let json; try{ json = pm.response.json(); } catch(e){ json = {}; }",
                  "if (json && json.id) {",
                  "  pm.environment.set('user_id', json.id);",
                  "  pm.environment.set('user_email', json.email);",
                  "}",
                  "pm.test('Status 200', function () { pm.response.to.have.status(200); });"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Get User by Id",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/users/{{user_id}}",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "users",
                "{{user_id}}"
              ]
            }
          }
        },
        {
          "name": "Get User by Email",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/users/by-email?email={{user_email}}",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "users",
                "by-email"
              ],
              "query": [
                {
                  "key": "email",
                  "value": "{{user_email}}"
                }
              ]
            }
          }
        },
        {
          "name": "Rename User",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/users/{{user_id}}/name",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "users",
                "{{user_id}}",
                "name"
              ]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"fullName\": \"User One Renamed\"\n}"
            }
          }
        },
        {
          "name": "Change Status",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/users/{{user_id}}/status",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "users",
                "{{user_id}}",
                "status"
              ]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"INACTIVE\"\n}"
            }
          }
        },
        {
          "name": "Set System Admin",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/users/{{user_id}}/system-admin",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "users",
                "{{user_id}}",
                "system-admin"
              ]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"systemAdmin\": true\n}"
            }
          }
        },
        {
          "name": "List Users",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/users?search=&status=&systemAdmin=&page=0&size=20",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "users"
              ],
              "query": [
                {
                  "key": "search",
                  "value": ""
                },
                {
                  "key": "status",
                  "value": ""
                },
                {
                  "key": "systemAdmin",
                  "value": ""
                },
                {
                  "key": "page",
                  "value": "0"
                },
                {
                  "key": "size",
                  "value": "20"
                }
              ]
            }
          }
        },
        {
          "name": "Delete User",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/users/{{user_id}}",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "users",
                "{{user_id}}"
              ]
            }
          }
        }
      ]
    },
    {
      "name": "Forms (protected)",
      "item": [
        {
          "name": "Create Form",
          "request": {
            "method": "POST",
            "url": {
              "raw": "{{base_url}}/api/forms",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "forms"
              ]
            },
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"campaignId\": \"{{campaign_id}}\",\n  \"title\": \"Encuesta Satisfacción Docente 2025-1\",\n  \"description\": \"Formulario base de satisfacción para docentes 2025-1\",\n  \"coverUrl\": \"https://example.com/cover.png\",\n  \"themeMode\": \"light\",\n  \"themePrimary\": \"#3b82f6\",\n  \"accessMode\": \"PUBLIC\",\n  \"openAt\": \"2025-11-10T12:00:00Z\",\n  \"closeAt\": \"2025-12-31T23:59:00Z\",\n  \"responseLimitMode\": \"UNLIMITED\",\n  \"limitedN\": null,\n  \"anonymousMode\": true,\n  \"allowEditBeforeSubmit\": true,\n  \"autoSave\": true,\n  \"shuffleQuestions\": false,\n  \"shuffleOptions\": false,\n  \"progressBar\": true,\n  \"paginated\": true\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', () => pm.response.to.have.status(200));",
                  "let json = {}; try { json = pm.response.json(); } catch(e) {}",
                  "if (json && json.id) { pm.environment.set('form_id', json.id); }"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Get Form by Id",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{base_url}}/api/forms/{{form_id}}",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "forms",
                "{{form_id}}"
              ]
            },
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ]
          }
        },
        {
          "name": "Rename Form",
          "request": {
            "method": "PATCH",
            "url": {
              "raw": "{{base_url}}/api/forms/{{form_id}}/title",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "forms",
                "{{form_id}}",
                "title"
              ]
            },
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"Encuesta Clima Institucional 2025\"\n}"
            }
          }
        },
        {
          "name": "Change Description",
          "request": {
            "method": "PATCH",
            "url": {
              "raw": "{{base_url}}/api/forms/{{form_id}}/description",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "forms",
                "{{form_id}}",
                "description"
              ]
            },
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"description\": \"Instrumento para medir el clima institucional 2025 (piloto).\"\n}"
            }
          }
        },
        {
          "name": "Change Theme",
          "request": {
            "method": "PATCH",
            "url": {
              "raw": "{{base_url}}/api/forms/{{form_id}}/theme",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "forms",
                "{{form_id}}",
                "theme"
              ]
            },
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"mode\": \"dark\",\n  \"primaryColor\": \"#10b981\"\n}"
            }
          }
        },
        {
          "name": "Set Access Mode (PRIVATE)",
          "request": {
            "method": "PATCH",
            "url": {
              "raw": "{{base_url}}/api/forms/{{form_id}}/access-mode",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "forms",
                "{{form_id}}",
                "access-mode"
              ]
            },
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"mode\": \"PRIVATE\"\n}"
            }
          }
        },
        {
          "name": "Reschedule Form",
          "request": {
            "method": "PATCH",
            "url": {
              "raw": "{{base_url}}/api/forms/{{form_id}}/schedule",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "forms",
                "{{form_id}}",
                "schedule"
              ]
            },
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"openAt\": \"2025-11-15T00:00:00Z\",\n  \"closeAt\": \"2026-01-15T23:59:00Z\"\n}"
            }
          }
        },
        {
          "name": "Set Limit Policy (LIMITED_N=1)",
          "request": {
            "method": "PATCH",
            "url": {
              "raw": "{{base_url}}/api/forms/{{form_id}}/limit-policy",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "forms",
                "{{form_id}}",
                "limit-policy"
              ]
            },
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"mode\": \"LIMITED_N\",\n  \"n\": 1\n}"
            }
          }
        },
        {
          "name": "Set Presentation (shuffle ON)",
          "request": {
            "method": "PATCH",
            "url": {
              "raw": "{{base_url}}/api/forms/{{form_id}}/presentation",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "forms",
                "{{form_id}}",
                "presentation"
              ]
            },
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"shuffleQuestions\": true,\n  \"shuffleOptions\": true,\n  \"progressBar\": true,\n  \"paginated\": true\n}"
            }
          }
        },
        {
          "name": "Toggle Anonymous (false)",
          "request": {
            "method": "PATCH",
            "url": {
              "raw": "{{base_url}}/api/forms/{{form_id}}/anonymous",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "forms",
                "{{form_id}}",
                "anonymous"
              ]
            },
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"enabled\": false\n}"
            }
          }
        },
        {
          "name": "Toggle Allow Edit (false)",
          "request": {
            "method": "PATCH",
            "url": {
              "raw": "{{base_url}}/api/forms/{{form_id}}/allow-edit",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "forms",
                "{{form_id}}",
                "allow-edit"
              ]
            },
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"enabled\": false\n}"
            }
          }
        },
        {
          "name": "Toggle AutoSave (false)",
          "request": {
            "method": "PATCH",
            "url": {
              "raw": "{{base_url}}/api/forms/{{form_id}}/autosave",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "forms",
                "{{form_id}}",
                "autosave"
              ]
            },
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"enabled\": false\n}"
            }
          }
        },
        {
          "name": "Change Status (published)",
          "request": {
            "method": "PATCH",
            "url": {
              "raw": "{{base_url}}/api/forms/{{form_id}}/status",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "forms",
                "{{form_id}}",
                "status"
              ]
            },
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"published\"\n}"
            }
          }
        },
        {
          "name": "List Forms",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{base_url}}/api/forms?campaignId={{campaign_id}}&search=&status=&accessMode=&openFrom=&closeTo=&page=0&size=20",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "forms"
              ],
              "query": [
                {
                  "key": "campaignId",
                  "value": "{{campaign_id}}"
                },
                {
                  "key": "search",
                  "value": ""
                },
                {
                  "key": "status",
                  "value": ""
                },
                {
                  "key": "accessMode",
                  "value": ""
                },
                {
                  "key": "openFrom",
                  "value": ""
                },
                {
                  "key": "closeTo",
                  "value": ""
                },
                {
                  "key": "page",
                  "value": "0"
                },
                {
                  "key": "size",
                  "value": "20"
                }
              ]
            },
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ]
          }
        },
        {
          "name": "Delete Form",
          "request": {
            "method": "DELETE",
            "url": {
              "raw": "{{base_url}}/api/forms/{{form_id}}",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "forms",
                "{{form_id}}"
              ]
            },
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ]
          }
        },
        {
          "name": "Sections",
          "item": [
            {
              "name": "Add Section",
              "request": {
                "method": "POST",
                "url": {
                  "raw": "{{base_url}}/api/forms/{{form_id}}/sections",
                  "host": [
                    "{{base_url}}"
                  ],
                  "path": [
                    "api",
                    "forms",
                    "{{form_id}}",
                    "sections"
                  ]
                },
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{token}}"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"title\": \"Página 1 - Datos Generales\"\n}"
                }
              },
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('Status 200', () => pm.response.to.have.status(200));",
                      "let json = {}; try { json = pm.response.json(); } catch(e) {}",
                      "if (json && json.id) { pm.environment.set('section_id', json.id); }"
                    ],
                    "type": "text/javascript"
                  }
                }
              ]
            },
            {
              "name": "Rename Section",
              "request": {
                "method": "PATCH",
                "url": {
                  "raw": "{{base_url}}/api/forms/{{form_id}}/sections/{{section_id}}/title",
                  "host": [
                    "{{base_url}}"
                  ],
                  "path": [
                    "api",
                    "forms",
                    "{{form_id}}",
                    "sections",
                    "{{section_id}}",
                    "title"
                  ]
                },
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{token}}"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"title\": \"Página 1 - Información General\"\n}"
                }
              }
            },
            {
              "name": "Move Section (to 0)",
              "request": {
                "method": "PATCH",
                "url": {
                  "raw": "{{base_url}}/api/forms/{{form_id}}/sections/{{section_id}}/move/0",
                  "host": [
                    "{{base_url}}"
                  ],
                  "path": [
                    "api",
                    "forms",
                    "{{form_id}}",
                    "sections",
                    "{{section_id}}",
                    "move",
                    "0"
                  ]
                },
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{token}}"
                  }
                ]
              }
            },
            {
              "name": "List Sections",
              "request": {
                "method": "GET",
                "url": {
                  "raw": "{{base_url}}/api/forms/{{form_id}}/sections?page=0&size=50",
                  "host": [
                    "{{base_url}}"
                  ],
                  "path": [
                    "api",
                    "forms",
                    "{{form_id}}",
                    "sections"
                  ],
                  "query": [
                    {
                      "key": "page",
                      "value": "0"
                    },
                    {
                      "key": "size",
                      "value": "50"
                    }
                  ]
                },
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{token}}"
                  }
                ]
              }
            },
            {
              "name": "Delete Section",
              "request": {
                "method": "DELETE",
                "url": {
                  "raw": "{{base_url}}/api/forms/{{form_id}}/sections/{{section_id}}",
                  "host": [
                    "{{base_url}}"
                  ],
                  "path": [
                    "api",
                    "forms",
                    "{{form_id}}",
                    "sections",
                    "{{section_id}}"
                  ]
                },
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{token}}"
                  }
                ]
              }
            }
          ]
        }
      ]
    }
  ]
}